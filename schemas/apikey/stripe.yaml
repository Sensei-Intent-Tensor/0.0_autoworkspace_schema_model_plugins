openapi: "3.1.0"
info:
  title: Stripe Payments API
  version: "1.0.0"
  description: |
    Drop-in schema for Stripe's Payments API.
    
    ## Required Placeholders
    - `{{STRIPE_SECRET_KEY}}`: Your Stripe secret key (sk_test_... or sk_live_...)
    
    ## Authentication
    Bearer token via `Authorization` header
    
    ## Key Features
    - Payment processing (cards, bank, wallets)
    - Customer management
    - Subscriptions & recurring billing
    - Invoicing
    - Product catalog
    
    ## ChatGPT Compatible
    Yes
    
    ## Test Mode
    Use `sk_test_...` keys for testing. No real charges.
    
    ## Idempotency
    Include `Idempotency-Key` header to safely retry requests.
    
    ## Pricing
    2.9% + 30Â¢ per successful card charge (US)
    See https://stripe.com/pricing
  contact:
    name: Auto-Workspace-AI
    url: https://auto-workspace-ai.com
  externalDocs:
    description: Stripe API Documentation
    url: https://stripe.com/docs/api

servers:
  - url: https://api.stripe.com/v1
    description: Stripe API v1

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: |
        Stripe Secret Key as Bearer token.
        Format: `Authorization: Bearer {{STRIPE_SECRET_KEY}}`

  schemas:
    # ============ CUSTOMER SCHEMAS ============
    Customer:
      type: object
      properties:
        id:
          type: string
          description: Unique customer ID
          example: "cus_NffrFeUfNV2Hib"
        object:
          type: string
          enum: [customer]
        name:
          type: string
          nullable: true
        email:
          type: string
          nullable: true
        phone:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        address:
          $ref: '#/components/schemas/Address'
        balance:
          type: integer
          description: Current balance in cents
        currency:
          type: string
          description: Three-letter ISO currency code
        default_source:
          type: string
          nullable: true
          description: Default payment source ID
        invoice_prefix:
          type: string
        metadata:
          type: object
          additionalProperties:
            type: string
        created:
          type: integer
          description: Unix timestamp
        livemode:
          type: boolean

    Address:
      type: object
      properties:
        line1:
          type: string
        line2:
          type: string
          nullable: true
        city:
          type: string
        state:
          type: string
        postal_code:
          type: string
        country:
          type: string
          description: Two-letter ISO country code

    # ============ PAYMENT INTENT SCHEMAS ============
    PaymentIntent:
      type: object
      properties:
        id:
          type: string
          example: "pi_3MtwBwLkdIwHu7ix28a3tqPa"
        object:
          type: string
          enum: [payment_intent]
        amount:
          type: integer
          description: Amount in cents
        amount_received:
          type: integer
        currency:
          type: string
        status:
          type: string
          enum: [requires_payment_method, requires_confirmation, requires_action, processing, requires_capture, canceled, succeeded]
        client_secret:
          type: string
          description: Secret for client-side confirmation
        customer:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        metadata:
          type: object
          additionalProperties:
            type: string
        payment_method:
          type: string
          nullable: true
        payment_method_types:
          type: array
          items:
            type: string
        receipt_email:
          type: string
          nullable: true
        setup_future_usage:
          type: string
          nullable: true
          enum: [on_session, off_session]
        shipping:
          $ref: '#/components/schemas/Shipping'
        statement_descriptor:
          type: string
          nullable: true
        statement_descriptor_suffix:
          type: string
          nullable: true
        created:
          type: integer
        livemode:
          type: boolean
        last_payment_error:
          type: object
          nullable: true
          properties:
            code:
              type: string
            message:
              type: string
            type:
              type: string

    Shipping:
      type: object
      properties:
        address:
          $ref: '#/components/schemas/Address'
        name:
          type: string
        phone:
          type: string
        carrier:
          type: string
        tracking_number:
          type: string

    # ============ CHARGE SCHEMAS ============
    Charge:
      type: object
      properties:
        id:
          type: string
          example: "ch_3MmlLrLkdIwHu7ix0snN0B15"
        object:
          type: string
          enum: [charge]
        amount:
          type: integer
        amount_captured:
          type: integer
        amount_refunded:
          type: integer
        currency:
          type: string
        status:
          type: string
          enum: [succeeded, pending, failed]
        paid:
          type: boolean
        refunded:
          type: boolean
        captured:
          type: boolean
        customer:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        receipt_url:
          type: string
          nullable: true
        receipt_email:
          type: string
          nullable: true
        payment_intent:
          type: string
          nullable: true
        payment_method:
          type: string
        billing_details:
          type: object
          properties:
            address:
              $ref: '#/components/schemas/Address'
            email:
              type: string
            name:
              type: string
            phone:
              type: string
        metadata:
          type: object
          additionalProperties:
            type: string
        created:
          type: integer
        livemode:
          type: boolean

    # ============ PRODUCT & PRICE SCHEMAS ============
    Product:
      type: object
      properties:
        id:
          type: string
          example: "prod_NWjs8kKbJWmuuc"
        object:
          type: string
          enum: [product]
        name:
          type: string
        description:
          type: string
          nullable: true
        active:
          type: boolean
        default_price:
          type: string
          nullable: true
        images:
          type: array
          items:
            type: string
        metadata:
          type: object
          additionalProperties:
            type: string
        unit_label:
          type: string
          nullable: true
        url:
          type: string
          nullable: true
        created:
          type: integer
        updated:
          type: integer
        livemode:
          type: boolean

    Price:
      type: object
      properties:
        id:
          type: string
          example: "price_1MoBy5LkdIwHu7ixZhnattbh"
        object:
          type: string
          enum: [price]
        product:
          type: string
        active:
          type: boolean
        currency:
          type: string
        unit_amount:
          type: integer
          nullable: true
          description: Price in cents
        unit_amount_decimal:
          type: string
          nullable: true
        type:
          type: string
          enum: [one_time, recurring]
        billing_scheme:
          type: string
          enum: [per_unit, tiered]
        recurring:
          type: object
          nullable: true
          properties:
            interval:
              type: string
              enum: [day, week, month, year]
            interval_count:
              type: integer
            usage_type:
              type: string
              enum: [metered, licensed]
        metadata:
          type: object
          additionalProperties:
            type: string
        nickname:
          type: string
          nullable: true
        created:
          type: integer
        livemode:
          type: boolean

    # ============ SUBSCRIPTION SCHEMAS ============
    Subscription:
      type: object
      properties:
        id:
          type: string
          example: "sub_1MowQVLkdIwHu7ixeRlqHVzs"
        object:
          type: string
          enum: [subscription]
        customer:
          type: string
        status:
          type: string
          enum: [incomplete, incomplete_expired, trialing, active, past_due, canceled, unpaid, paused]
        items:
          type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/SubscriptionItem'
        current_period_start:
          type: integer
        current_period_end:
          type: integer
        cancel_at_period_end:
          type: boolean
        canceled_at:
          type: integer
          nullable: true
        ended_at:
          type: integer
          nullable: true
        trial_start:
          type: integer
          nullable: true
        trial_end:
          type: integer
          nullable: true
        default_payment_method:
          type: string
          nullable: true
        latest_invoice:
          type: string
          nullable: true
        metadata:
          type: object
          additionalProperties:
            type: string
        created:
          type: integer
        livemode:
          type: boolean

    SubscriptionItem:
      type: object
      properties:
        id:
          type: string
        object:
          type: string
          enum: [subscription_item]
        price:
          $ref: '#/components/schemas/Price'
        quantity:
          type: integer
        subscription:
          type: string

    # ============ INVOICE SCHEMAS ============
    Invoice:
      type: object
      properties:
        id:
          type: string
          example: "in_1MtHbELkdIwHu7ixl4OzzPMv"
        object:
          type: string
          enum: [invoice]
        customer:
          type: string
        customer_email:
          type: string
          nullable: true
        customer_name:
          type: string
          nullable: true
        status:
          type: string
          enum: [draft, open, paid, uncollectible, void]
        amount_due:
          type: integer
        amount_paid:
          type: integer
        amount_remaining:
          type: integer
        currency:
          type: string
        description:
          type: string
          nullable: true
        due_date:
          type: integer
          nullable: true
        hosted_invoice_url:
          type: string
          nullable: true
        invoice_pdf:
          type: string
          nullable: true
        lines:
          type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/InvoiceLineItem'
        subscription:
          type: string
          nullable: true
        total:
          type: integer
        subtotal:
          type: integer
        tax:
          type: integer
          nullable: true
        metadata:
          type: object
          additionalProperties:
            type: string
        paid:
          type: boolean
        number:
          type: string
          nullable: true
        collection_method:
          type: string
          enum: [charge_automatically, send_invoice]
        created:
          type: integer
        livemode:
          type: boolean

    InvoiceLineItem:
      type: object
      properties:
        id:
          type: string
        object:
          type: string
          enum: [line_item]
        amount:
          type: integer
        currency:
          type: string
        description:
          type: string
        quantity:
          type: integer
        price:
          $ref: '#/components/schemas/Price'

    # ============ PAYMENT METHOD SCHEMAS ============
    PaymentMethod:
      type: object
      properties:
        id:
          type: string
          example: "pm_1MqLiJLkdIwHu7ixUEgbFdYF"
        object:
          type: string
          enum: [payment_method]
        type:
          type: string
          enum: [card, us_bank_account, sepa_debit, link, paypal]
        customer:
          type: string
          nullable: true
        billing_details:
          type: object
          properties:
            address:
              $ref: '#/components/schemas/Address'
            email:
              type: string
            name:
              type: string
            phone:
              type: string
        card:
          type: object
          properties:
            brand:
              type: string
              enum: [amex, diners, discover, jcb, mastercard, unionpay, visa, unknown]
            last4:
              type: string
            exp_month:
              type: integer
            exp_year:
              type: integer
            funding:
              type: string
              enum: [credit, debit, prepaid, unknown]
        metadata:
          type: object
          additionalProperties:
            type: string
        created:
          type: integer
        livemode:
          type: boolean

    # ============ REFUND SCHEMA ============
    Refund:
      type: object
      properties:
        id:
          type: string
          example: "re_1Nispe2eZvKYlo2Cd31jOCgZ"
        object:
          type: string
          enum: [refund]
        amount:
          type: integer
        charge:
          type: string
        currency:
          type: string
        status:
          type: string
          enum: [pending, requires_action, succeeded, failed, canceled]
        reason:
          type: string
          nullable: true
          enum: [duplicate, fraudulent, requested_by_customer]
        receipt_number:
          type: string
          nullable: true
        payment_intent:
          type: string
          nullable: true
        metadata:
          type: object
          additionalProperties:
            type: string
        created:
          type: integer

    # ============ LIST RESPONSE ============
    ListResponse:
      type: object
      properties:
        object:
          type: string
          enum: [list]
        data:
          type: array
          items: {}
        has_more:
          type: boolean
        url:
          type: string

    # ============ ERROR ============
    Error:
      type: object
      properties:
        error:
          type: object
          properties:
            type:
              type: string
              enum: [api_error, card_error, idempotency_error, invalid_request_error]
            code:
              type: string
            message:
              type: string
            param:
              type: string
            decline_code:
              type: string

security:
  - BearerAuth: []

paths:
  # ============ CUSTOMERS ============
  /customers:
    get:
      operationId: listCustomers
      summary: List customers
      description: Returns a list of customers
      tags:
        - Customers
      parameters:
        - name: limit
          in: query
          description: Number of results (1-100)
          schema:
            type: integer
            default: 10
            maximum: 100
        - name: starting_after
          in: query
          description: Cursor for pagination
          schema:
            type: string
        - name: ending_before
          in: query
          schema:
            type: string
        - name: email
          in: query
          description: Filter by email
          schema:
            type: string
        - name: created[gte]
          in: query
          description: Created after timestamp
          schema:
            type: integer
        - name: created[lte]
          in: query
          description: Created before timestamp
          schema:
            type: integer
      responses:
        '200':
          description: List of customers
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ListResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Customer'

    post:
      operationId: createCustomer
      summary: Create a customer
      description: Creates a new customer
      tags:
        - Customers
      requestBody:
        required: false
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                email:
                  type: string
                name:
                  type: string
                phone:
                  type: string
                description:
                  type: string
                address[line1]:
                  type: string
                address[line2]:
                  type: string
                address[city]:
                  type: string
                address[state]:
                  type: string
                address[postal_code]:
                  type: string
                address[country]:
                  type: string
                payment_method:
                  type: string
                  description: Attach payment method
                metadata[key]:
                  type: string
            examples:
              basic:
                summary: Basic customer
                value:
                  email: "customer@example.com"
                  name: "John Doe"
              withAddress:
                summary: With address
                value:
                  email: "customer@example.com"
                  name: "John Doe"
                  address[line1]: "123 Main St"
                  address[city]: "San Francisco"
                  address[state]: "CA"
                  address[postal_code]: "94102"
                  address[country]: "US"
      responses:
        '200':
          description: Created customer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Customer'

  /customers/{id}:
    get:
      operationId: getCustomer
      summary: Retrieve a customer
      tags:
        - Customers
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Customer details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Customer'

    post:
      operationId: updateCustomer
      summary: Update a customer
      tags:
        - Customers
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                email:
                  type: string
                name:
                  type: string
                phone:
                  type: string
                description:
                  type: string
                default_source:
                  type: string
                metadata[key]:
                  type: string
      responses:
        '200':
          description: Updated customer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Customer'

    delete:
      operationId: deleteCustomer
      summary: Delete a customer
      tags:
        - Customers
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Deleted confirmation
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  object:
                    type: string
                  deleted:
                    type: boolean

  # ============ PAYMENT INTENTS ============
  /payment_intents:
    get:
      operationId: listPaymentIntents
      summary: List payment intents
      tags:
        - Payment Intents
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: customer
          in: query
          description: Filter by customer
          schema:
            type: string
        - name: starting_after
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of payment intents
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ListResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/PaymentIntent'

    post:
      operationId: createPaymentIntent
      summary: Create a payment intent
      description: |
        Creates a PaymentIntent for collecting payment.
        
        Use this for one-time payments. The PaymentIntent tracks
        the payment lifecycle from creation to completion.
      tags:
        - Payment Intents
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - amount
                - currency
              properties:
                amount:
                  type: integer
                  description: Amount in cents (e.g., 1000 = $10.00)
                currency:
                  type: string
                  description: Three-letter ISO currency code
                  example: "usd"
                customer:
                  type: string
                  description: Customer ID
                description:
                  type: string
                payment_method:
                  type: string
                  description: Payment method ID
                payment_method_types[]:
                  type: string
                  description: Allowed payment method types
                confirm:
                  type: boolean
                  description: Confirm immediately
                receipt_email:
                  type: string
                setup_future_usage:
                  type: string
                  enum: [on_session, off_session]
                statement_descriptor:
                  type: string
                  description: Statement description (max 22 chars)
                metadata[key]:
                  type: string
            examples:
              basic:
                summary: Basic payment
                value:
                  amount: 2000
                  currency: "usd"
              withCustomer:
                summary: For existing customer
                value:
                  amount: 5000
                  currency: "usd"
                  customer: "cus_xxx"
                  receipt_email: "customer@example.com"
              saveCard:
                summary: Save card for future
                value:
                  amount: 1500
                  currency: "usd"
                  customer: "cus_xxx"
                  setup_future_usage: "off_session"
      responses:
        '200':
          description: Created payment intent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentIntent'

  /payment_intents/{id}:
    get:
      operationId: getPaymentIntent
      summary: Retrieve a payment intent
      tags:
        - Payment Intents
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Payment intent details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentIntent'

    post:
      operationId: updatePaymentIntent
      summary: Update a payment intent
      tags:
        - Payment Intents
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                amount:
                  type: integer
                description:
                  type: string
                customer:
                  type: string
                payment_method:
                  type: string
                receipt_email:
                  type: string
                metadata[key]:
                  type: string
      responses:
        '200':
          description: Updated payment intent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentIntent'

  /payment_intents/{id}/confirm:
    post:
      operationId: confirmPaymentIntent
      summary: Confirm a payment intent
      description: Confirms the payment intent and initiates the payment
      tags:
        - Payment Intents
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                payment_method:
                  type: string
                receipt_email:
                  type: string
                return_url:
                  type: string
                  description: URL for redirect-based payment methods
      responses:
        '200':
          description: Confirmed payment intent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentIntent'

  /payment_intents/{id}/cancel:
    post:
      operationId: cancelPaymentIntent
      summary: Cancel a payment intent
      tags:
        - Payment Intents
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                cancellation_reason:
                  type: string
                  enum: [duplicate, fraudulent, requested_by_customer, abandoned]
      responses:
        '200':
          description: Canceled payment intent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentIntent'

  /payment_intents/{id}/capture:
    post:
      operationId: capturePaymentIntent
      summary: Capture a payment intent
      description: Capture funds for a previously authorized payment
      tags:
        - Payment Intents
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                amount_to_capture:
                  type: integer
                  description: Amount to capture (for partial capture)
      responses:
        '200':
          description: Captured payment intent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentIntent'

  # ============ PRODUCTS ============
  /products:
    get:
      operationId: listProducts
      summary: List products
      tags:
        - Products
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: active
          in: query
          schema:
            type: boolean
        - name: starting_after
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of products
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ListResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Product'

    post:
      operationId: createProduct
      summary: Create a product
      tags:
        - Products
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                description:
                  type: string
                active:
                  type: boolean
                  default: true
                images[]:
                  type: string
                unit_label:
                  type: string
                url:
                  type: string
                metadata[key]:
                  type: string
            examples:
              basic:
                value:
                  name: "Premium Plan"
                  description: "Access to all premium features"
      responses:
        '200':
          description: Created product
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'

  /products/{id}:
    get:
      operationId: getProduct
      summary: Retrieve a product
      tags:
        - Products
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Product details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'

    post:
      operationId: updateProduct
      summary: Update a product
      tags:
        - Products
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
                active:
                  type: boolean
                metadata[key]:
                  type: string
      responses:
        '200':
          description: Updated product
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Product'

  # ============ PRICES ============
  /prices:
    get:
      operationId: listPrices
      summary: List prices
      tags:
        - Prices
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
        - name: product
          in: query
          description: Filter by product
          schema:
            type: string
        - name: active
          in: query
          schema:
            type: boolean
        - name: type
          in: query
          schema:
            type: string
            enum: [one_time, recurring]
      responses:
        '200':
          description: List of prices
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ListResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Price'

    post:
      operationId: createPrice
      summary: Create a price
      tags:
        - Prices
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - currency
                - product
              properties:
                product:
                  type: string
                currency:
                  type: string
                unit_amount:
                  type: integer
                  description: Price in cents
                recurring[interval]:
                  type: string
                  enum: [day, week, month, year]
                recurring[interval_count]:
                  type: integer
                nickname:
                  type: string
                active:
                  type: boolean
                metadata[key]:
                  type: string
            examples:
              oneTime:
                summary: One-time price
                value:
                  product: "prod_xxx"
                  currency: "usd"
                  unit_amount: 2999
              monthly:
                summary: Monthly subscription
                value:
                  product: "prod_xxx"
                  currency: "usd"
                  unit_amount: 999
                  recurring[interval]: "month"
              yearly:
                summary: Yearly subscription
                value:
                  product: "prod_xxx"
                  currency: "usd"
                  unit_amount: 9999
                  recurring[interval]: "year"
      responses:
        '200':
          description: Created price
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Price'

  /prices/{id}:
    get:
      operationId: getPrice
      summary: Retrieve a price
      tags:
        - Prices
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Price details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Price'

  # ============ SUBSCRIPTIONS ============
  /subscriptions:
    get:
      operationId: listSubscriptions
      summary: List subscriptions
      tags:
        - Subscriptions
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
        - name: customer
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [incomplete, incomplete_expired, trialing, active, past_due, canceled, unpaid, paused, all]
        - name: starting_after
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of subscriptions
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ListResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Subscription'

    post:
      operationId: createSubscription
      summary: Create a subscription
      description: Creates a new subscription for a customer
      tags:
        - Subscriptions
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - customer
                - items[0][price]
              properties:
                customer:
                  type: string
                items[0][price]:
                  type: string
                  description: Price ID
                items[0][quantity]:
                  type: integer
                default_payment_method:
                  type: string
                cancel_at_period_end:
                  type: boolean
                trial_period_days:
                  type: integer
                trial_end:
                  type: integer
                  description: Unix timestamp
                proration_behavior:
                  type: string
                  enum: [create_prorations, none, always_invoice]
                metadata[key]:
                  type: string
            examples:
              basic:
                summary: Basic subscription
                value:
                  customer: "cus_xxx"
                  items[0][price]: "price_xxx"
              withTrial:
                summary: With trial period
                value:
                  customer: "cus_xxx"
                  items[0][price]: "price_xxx"
                  trial_period_days: 14
      responses:
        '200':
          description: Created subscription
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'

  /subscriptions/{id}:
    get:
      operationId: getSubscription
      summary: Retrieve a subscription
      tags:
        - Subscriptions
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Subscription details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'

    post:
      operationId: updateSubscription
      summary: Update a subscription
      tags:
        - Subscriptions
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                cancel_at_period_end:
                  type: boolean
                default_payment_method:
                  type: string
                items[0][id]:
                  type: string
                items[0][price]:
                  type: string
                items[0][quantity]:
                  type: integer
                proration_behavior:
                  type: string
                metadata[key]:
                  type: string
      responses:
        '200':
          description: Updated subscription
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'

    delete:
      operationId: cancelSubscription
      summary: Cancel a subscription
      tags:
        - Subscriptions
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                invoice_now:
                  type: boolean
                  description: Generate final invoice
                prorate:
                  type: boolean
                  description: Prorate final invoice
      responses:
        '200':
          description: Canceled subscription
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Subscription'

  # ============ INVOICES ============
  /invoices:
    get:
      operationId: listInvoices
      summary: List invoices
      tags:
        - Invoices
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
        - name: customer
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
            enum: [draft, open, paid, uncollectible, void]
        - name: subscription
          in: query
          schema:
            type: string
        - name: starting_after
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of invoices
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ListResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Invoice'

    post:
      operationId: createInvoice
      summary: Create an invoice
      tags:
        - Invoices
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - customer
              properties:
                customer:
                  type: string
                description:
                  type: string
                collection_method:
                  type: string
                  enum: [charge_automatically, send_invoice]
                days_until_due:
                  type: integer
                auto_advance:
                  type: boolean
                metadata[key]:
                  type: string
      responses:
        '200':
          description: Created invoice
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invoice'

  /invoices/{id}:
    get:
      operationId: getInvoice
      summary: Retrieve an invoice
      tags:
        - Invoices
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Invoice details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invoice'

  /invoices/{id}/finalize:
    post:
      operationId: finalizeInvoice
      summary: Finalize an invoice
      description: Finalize a draft invoice and open it for payment
      tags:
        - Invoices
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Finalized invoice
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invoice'

  /invoices/{id}/pay:
    post:
      operationId: payInvoice
      summary: Pay an invoice
      description: Pay an open invoice
      tags:
        - Invoices
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                payment_method:
                  type: string
                source:
                  type: string
      responses:
        '200':
          description: Paid invoice
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invoice'

  /invoices/{id}/void:
    post:
      operationId: voidInvoice
      summary: Void an invoice
      tags:
        - Invoices
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Voided invoice
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Invoice'

  # ============ REFUNDS ============
  /refunds:
    get:
      operationId: listRefunds
      summary: List refunds
      tags:
        - Refunds
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
        - name: charge
          in: query
          schema:
            type: string
        - name: payment_intent
          in: query
          schema:
            type: string
        - name: starting_after
          in: query
          schema:
            type: string
      responses:
        '200':
          description: List of refunds
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ListResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Refund'

    post:
      operationId: createRefund
      summary: Create a refund
      description: |
        Refund a charge or payment intent.
        
        Provide either `charge` or `payment_intent`, not both.
      tags:
        - Refunds
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              properties:
                charge:
                  type: string
                  description: Charge ID to refund
                payment_intent:
                  type: string
                  description: Payment Intent ID to refund
                amount:
                  type: integer
                  description: Amount in cents (partial refund)
                reason:
                  type: string
                  enum: [duplicate, fraudulent, requested_by_customer]
                metadata[key]:
                  type: string
            examples:
              full:
                summary: Full refund
                value:
                  payment_intent: "pi_xxx"
              partial:
                summary: Partial refund
                value:
                  payment_intent: "pi_xxx"
                  amount: 500
                  reason: "requested_by_customer"
      responses:
        '200':
          description: Created refund
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Refund'

  /refunds/{id}:
    get:
      operationId: getRefund
      summary: Retrieve a refund
      tags:
        - Refunds
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Refund details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Refund'

  # ============ PAYMENT METHODS ============
  /payment_methods:
    get:
      operationId: listPaymentMethods
      summary: List payment methods
      tags:
        - Payment Methods
      parameters:
        - name: customer
          in: query
          required: true
          schema:
            type: string
        - name: type
          in: query
          required: true
          schema:
            type: string
            enum: [card, us_bank_account, sepa_debit, link]
        - name: limit
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: List of payment methods
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ListResponse'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/PaymentMethod'

  /payment_methods/{id}:
    get:
      operationId: getPaymentMethod
      summary: Retrieve a payment method
      tags:
        - Payment Methods
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Payment method details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentMethod'

  /payment_methods/{id}/attach:
    post:
      operationId: attachPaymentMethod
      summary: Attach payment method to customer
      tags:
        - Payment Methods
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - customer
              properties:
                customer:
                  type: string
      responses:
        '200':
          description: Attached payment method
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentMethod'

  /payment_methods/{id}/detach:
    post:
      operationId: detachPaymentMethod
      summary: Detach payment method from customer
      tags:
        - Payment Methods
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Detached payment method
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentMethod'

  # ============ BALANCE ============
  /balance:
    get:
      operationId: getBalance
      summary: Retrieve balance
      description: Returns the current account balance
      tags:
        - Balance
      responses:
        '200':
          description: Account balance
          content:
            application/json:
              schema:
                type: object
                properties:
                  object:
                    type: string
                    enum: [balance]
                  available:
                    type: array
                    items:
                      type: object
                      properties:
                        amount:
                          type: integer
                        currency:
                          type: string
                  pending:
                    type: array
                    items:
                      type: object
                      properties:
                        amount:
                          type: integer
                        currency:
                          type: string
                  livemode:
                    type: boolean
